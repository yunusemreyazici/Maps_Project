import{a as I}from"../../../_chunks/chunk-6OFSWPLP.js";import{a as x}from"../../../_chunks/chunk-U5SKCCFF.js";import{h as C,j as w,k as v,l as g,m as s,n as h}from"../../../_chunks/chunk-SHZY47RY.js";import{c as o,g as p,h as c,k as f}from"../../../_chunks/chunk-LRH74UCM.js";var b=p(f(),1);var m=p(f(),1);var t=p(f(),1);var e=p(f(),1);var d=class extends e.TemplatedDialog{constructor(r){super(r);this.permissions=new I(this.byId("Permissions"),{showRevoke:!0}),g.List({UserID:this.options.userID,Module:null,Submodule:null},n=>{this.permissions.value=n.Entities}),g.ListRolePermissions({UserID:this.options.userID,Module:null,Submodule:null},n=>{this.permissions.rolePermissions=n.Entities}),this.permissions.implicitPermissions=(0,e.getRemoteData)("Administration.ImplicitPermissions"),this.dialogTitle=(0,e.format)((0,e.localText)("Site.UserPermissionDialog.DialogTitle"),this.options.username)}getDialogButtons(){return[{text:(0,e.localText)("Dialogs.OkButton"),cssClass:"btn btn-primary",click:r=>{g.Update({UserID:this.options.userID,Permissions:this.permissions.value,Module:null,Submodule:null},n=>{this.dialogClose(),window.setTimeout(()=>(0,e.notifySuccess)((0,e.localText)("Site.UserPermissionDialog.SaveSuccess")),0)})}},{text:(0,e.localText)("Dialogs.CancelButton"),click:()=>this.dialogClose()}]}getTemplate(){return'<div id="~_Permissions"></div>'}};o(d,"UserPermissionDialog");var a=class extends t.EntityDialog{constructor(){super();this.form=new v(this.idPrefix);this.form.Password.element.attr("autocomplete","new-password"),this.form.Password.change(()=>{t.EditorUtils.setRequired(this.form.PasswordConfirm,this.form.Password.value.length>0)}),this.form.Password.addValidationRule(this.uniqueName,r=>{if(this.form.Password.value.length<6)return(0,t.format)((0,t.localText)("Validation.MinRequiredPasswordLength"),6)}),this.form.PasswordConfirm.addValidationRule(this.uniqueName,r=>{if(this.form.Password.value!=this.form.PasswordConfirm.value)return(0,t.localText)("Validation.PasswordConfirmMismatch")})}getFormKey(){return v.formKey}getIdProperty(){return s.idProperty}getIsActiveProperty(){return s.isActiveProperty}getLocalTextPrefix(){return s.localTextPrefix}getNameProperty(){return s.nameProperty}getService(){return h.baseUrl}getToolbarButtons(){let r=super.getToolbarButtons();return r.push({title:(0,t.localText)(x.Site.UserDialog.EditPermissionsButton),cssClass:"edit-permissions-button",icon:"fa-lock text-green",onClick:()=>{new d({userID:this.entity.UserId,username:this.entity.Username}).dialogOpen()}}),r}updateInterface(){super.updateInterface(),this.toolbar.findButton("edit-permissions-button").toggleClass("disabled",this.isNewOrDeleted())}afterLoadEntity(){super.afterLoadEntity(),this.form.Password.element.toggleClass("required",this.isNew()).closest(".field").find("sup").toggle(this.isNew()),this.form.PasswordConfirm.element.toggleClass("required",this.isNew()).closest(".field").find("sup").toggle(this.isNew())}};o(a,"UserDialog"),a=c([t.Decorators.registerClass()],a);var l=class extends m.EntityGrid{getColumnsKey(){return w.columnsKey}getDialogType(){return a}getIdProperty(){return s.idProperty}getIsActiveProperty(){return s.isActiveProperty}getLocalTextPrefix(){return s.localTextPrefix}getService(){return h.baseUrl}constructor(i){super(i)}getDefaultSortBy(){return[s.Fields.Username]}createIncludeDeletedButton(){}getColumns(){let i=new w(super.getColumns()),r=i.ImpersonationToken;r&&(r.format=u=>u.value?`<a target="_blank" href="${(0,m.resolveUrl)("~/Account/ImpersonateAs?token=")}${u.value}"><i class="fa fa-user-secret text-blue"></i></a>`:"");var n=i.Roles;if(n){var P;C.getLookupAsync().then(u=>{P=u,this.slickGrid.invalidate()}),n.format=u=>{if(!P)return'<i class="fa fa-spinner"></i>';var D=(u.value||[]).map(U=>(P.itemById[U]||{}).RoleName||"");return D.sort(),D.join(", ")}}return i.valueOf()}};o(l,"UserGrid"),l=c([m.Decorators.registerClass()],l);function R(){(0,b.initFullHeightGridPage)(new l($("#GridDiv")).element)}o(R,"pageInit");export{R as default};
//# sourceMappingURL=UserPage.js.map
