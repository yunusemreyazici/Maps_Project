import{a as Te}from"./chunk-5FVQGGD6.js";import{a as Re}from"./chunk-4KWZU47X.js";import{c as l,g as h,h as S,k as m}from"./chunk-LRH74UCM.js";var J=h(m(),1);var z=class extends J.ColumnsBase{};l(z,"BusinessTripColumns"),z.columnsKey="Trip.BusinessTrip",z.Fields=(0,J.fieldsProxy)();var U=h(m(),1);var R=class extends U.ColumnsBase{};l(R,"BusinessTripDetailColumns"),R.columnsKey="Trip.BusinessTripDetail",R.Fields=(0,U.fieldsProxy)();var se=h(m(),1);var w=class{};l(w,"BusinessTripDetailRow"),w.idProperty="Id",w.localTextPrefix="Trip.BusinessTripDetail",w.deletePermission="Administration:General",w.insertPermission="Administration:General",w.readPermission="Administration:General",w.updatePermission="Administration:General",w.Fields=(0,se.fieldsProxy)();var oe=h(m(),1),Y;(e=>(e.baseUrl="Trip/BusinessTripDetail",e.Methods={Create:"Trip/BusinessTripDetail/Create",Update:"Trip/BusinessTripDetail/Update",Delete:"Trip/BusinessTripDetail/Delete",Retrieve:"Trip/BusinessTripDetail/Retrieve",List:"Trip/BusinessTripDetail/List"},["Create","Update","Delete","Retrieve","List"].forEach(t=>{e[t]=function(r,s,i){return(0,oe.serviceRequest)(e.baseUrl+"/"+t,r,s,i)}})))(Y||(Y={}));var ne=h(m(),1);var D=class{};l(D,"BusinessTripRow"),D.idProperty="Id",D.nameProperty="Title",D.localTextPrefix="Trip.BusinessTrip",D.deletePermission="Administration:General",D.insertPermission="Administration:General",D.readPermission="Administration:General",D.updatePermission="Administration:General",D.Fields=(0,ne.fieldsProxy)();var le=h(m(),1),ae;(e=>(e.baseUrl="Trip/BusinessTrip",e.Methods={Create:"Trip/BusinessTrip/Create",Update:"Trip/BusinessTrip/Update",Delete:"Trip/BusinessTrip/Delete",Retrieve:"Trip/BusinessTrip/Retrieve",List:"Trip/BusinessTrip/List"},["Create","Update","Delete","Retrieve","List"].forEach(t=>{e[t]=function(r,s,i){return(0,le.serviceRequest)(e.baseUrl+"/"+t,r,s,i)}})))(ae||(ae={}));var V=h(m(),1);var Q=class extends V.PrefixedContext{constructor(g){if(super(g),!Q.init){Q.init=!0;var e=V.DecimalEditor;(0,V.initFormType)(Q,["Longitude",e,"Latitude",e])}}},k=Q;l(k,"BusinessTripDetailForm"),k.formKey="Trip.BusinessTripDetail";var Ee=h(m(),1);var x=h(m(),1);var a=h(m(),1);var u=h(m(),1);var E=h(m(),1);var ie=h(m(),1);var X=h(m(),1);var de=h(m(),1),ee=(i=>(i[i.Hour=1]="Hour",i[i.Day=2]="Day",i[i.Week=3]="Week",i[i.Month=4]="Month",i[i.CalenderMonth=5]="CalenderMonth",i[i.Year=6]="Year",i))(ee||{});de.Decorators.registerEnumType(ee,"_Ext.TimeUoM","TimeUoM");var ke=h(m(),1);function ue(c,g=!0){c&&(g==!0?c.element.closest(".field").show():c.element.closest(".field").hide())}l(ue,"showField");var ce=h(m(),1);var pe=null,he=!0,te={AutoColumnSize:!0,FadeInEffectWhenInit:!0,ShowAnyInEqualityFilterWithTextValue:!0,ShowInlineActionsColumn:!0,ShowDeleteInlineButtun:!1,ShowEditInlineButtun:!0,ShowPrintInlineButtun:!1,ShowRowNumberColumn:!0,ShowRowSelectionCheckboxColumn:!1,EnableQuickSearch:!0,RowsPerPage:20},me={AutoColumnSize:!0,FadeInEffectWhenInit:!0,ShowAnyInEqualityFilterWithTextValue:!0,ShowInlineActionsColumn:!0,ShowDeleteInlineButtun:!0,ShowEditInlineButtun:!0,ShowPrintInlineButtun:!1,ShowRowSelectionCheckboxColumn:!1,ShowRowNumberColumn:!0,EnableQuickSearch:!1},fe={AutoFitContentArea:!1,HideCategoyLinksBar:!0,PendingChangesConfirmation:!0,ShowSaveAndNewButtonInToolbar:!1,ShowCloseButtonInToolbar:!1,ShowRefreshButtonInToolbar:!1,ShowChangeLogButtonInToolbar:!0,ShowReplaceRowButtonInToolbar:!1,ShowKeyboardLayoutButtonInToolbar:!1},ge={AutoFitContentArea:!1,HideCategoyLinksBar:!0,PendingChangesConfirmation:!0,ShowSaveAndNewButtonInToolbar:!1,ShowCloseButtonInToolbar:!1,ShowRefreshButtonInToolbar:!1,ShowChangeLogButtonInToolbar:!1,ShowReplaceRowButtonInToolbar:!1,ShowKeyboardLayoutButtonInToolbar:!1};function y(c,g){var e=(0,ie.text)(c);return e==c?g:e}l(y,"text");var I=class extends E.TemplatedDialog{constructor(e){super(e);this.onSuccess=l(e=>{},"onSuccess");try{var t=(0,E.getType)(e.gridType);this.checkGrid=new t(this.byId("RowSelectionCheckGrid"),e),e.preSelectedKeys&&(this.checkGrid.selectedKeys=e.preSelectedKeys),this.dialogTitle=y("Controls.Select","Select")+" - "+this.checkGrid.getTitle(),this.checkGrid.setTitle(null),this.checkGrid.element.height(500),this.checkGrid.pickerDialog=this}catch(r){console.warn("Could not intialize "+e.gridType)}}getTemplate(){return`<div id="~_RowSelectionCheckGrid" 
                class="RowSelectionCheckGrid ${this.options.multiple==!0?"multi-select":"single-select"}" 
                style = "margin: 15px 15px 0 15px;" >
            </div>`}get selectedItems(){return this.checkGrid.selectedItems}getDialogOptions(){let e=super.getDialogOptions();return e.buttons=[{text:(0,E.text)("Dialogs.OkButton"),click:()=>{var t=this.checkGrid.selectedItems;if(!t.length){(0,E.notifyWarning)("Please select some items!");return}this.onSuccess(t),this.dialogClose()}},{text:(0,E.text)("Dialogs.CancelButton"),click:()=>{this.dialogClose()}}],e.height=500,e}};l(I,"GridItemPickerDialog"),I=S([E.Decorators.registerClass()],I);var T=class extends u.Widget{constructor(e,t){super(e,t);this.options=t;this.selectedItemIncludeColumns=[];this.importPagejs(t),this.element.addClass("select2-offscreen"),this.containerDiv=$(`<div class="editor s-GridItemPickerEditor select2-container ${t.multiple?"select2-container-multi":""} has-inplace-button">
                        <div class="${t.multiple?"select2-choices":"select2-choice"}">
                            <div class="display-text" style="user-select: text; padding-right: 20px;${t.multiple?"padding-left: 5px;":""}"></div>
                            <a class="select2-search-choice-close btn-clear-selection" style="margin-top: 2px; cursor: pointer; left: unset;"></a>
                        </div>
                    </div>`).insertBefore(this.element),this.addInplaceButtons(),this.setCascadeFrom(this.options.cascadeFrom)}importPagejs(e){let t=e.pageImportPath;t.startsWith("@/")&&(t="~/esm/Modules/"+t.substring(2),t.endsWith(".js")||(t+=".js")),t=(0,u.resolveUrl)(t),import(t)}addInplaceButtons(){var e=this;this.inplaceSearchButton=$('<a style="padding-top: 2px;"><i class="fa fa-search"></i></a>').addClass("inplace-button inplace-search align-center").attr("title","search").insertAfter(this.containerDiv).click(function(t){e.inplaceSearchClick(t)}),this.inplaceViewButton=$('<a style="padding-top: 2px;"><i class="fa fa-eye"></i></a>').addClass("inplace-button inplace-view align-center").attr("title","view").click(function(t){e.inplaceViewClick(t)}).hide(),this.options.inplaceView!=!1&&!this.options.multiple&&this.inplaceViewButton.insertAfter(this.containerDiv),this.clearSelectionButton=this.containerDiv.find(".select2-search-choice-close").click(t=>{this.value="",this.text="",this._selectedItem=null,this.selectedItems=[],$(t.target).hide(),this.element.trigger("change")}).hide()}inplaceSearchClick(e){this.options.preSelectedKeys=this.values;var t=new I(this.options);t.onSuccess=r=>{this.value=t.checkGrid.rowSelection.getSelectedKeys().join(","),this.text=r.map(s=>s[this.options.nameFieldInGridRow]).join(", "),(0,u.isEmptyOrNull)(this.text)&&console.warn("nameFieldInGridRow might be wrong in "+this.widgetName),this._selectedItem=r[0],this.selectedItems=r,this.element.trigger("change")},t.dialogOpen()}inplaceViewClick(e){var t=this.value;if(!(0,u.isEmptyOrNull)(t)){var r=this.getDialogInstance();r.isReadOnly=!0,r.loadByIdAndOpenDialog(t,!1)}}getDialogInstance(){var e=this.options.dialogType;e.prototype||(e=(0,u.getType)(this.options.dialogType));try{var t=new e;return t}catch(r){console.warn("Could not intialize "+this.options.dialogType)}}get value(){return this.element.val()}set value(e){this.element.val(e),(0,u.isEmptyOrNull)(e)?(this.text="",this.inplaceViewButton.hide(),this.clearSelectionButton.hide()):(this.inplaceViewButton.show(),this.get_readOnly()==!1&&this.clearSelectionButton.show())}get values(){let e=this.value;return(0,u.isEmptyOrNull)(e)?[]:e.split(",")}set values(e){this.value=e.join(",")}get text(){return this.containerDiv.find(".display-text").text()}set text(e){this.containerDiv.find(".display-text").text(e)}getEditValue(e,t){this.options.multiple==!0?t[e.name]=this.values:t[e.name]=this.value}setEditValue(e,t){this.value=e[t.name];let r=e[this.options.nameFieldInThisRow];this.text=r,e[t.name]&&(this._selectedItem={},this._selectedItem[this.options.idFieldInGridRow]=e[t.name],this._selectedItem[this.options.nameFieldInGridRow]=r)}get_value(){return this.value}set_value(e){this.value=e}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e?(this.element.addClass("readonly"),this.containerDiv.addClass("select2-container-disabled"),this.inplaceSearchButton.addClass("disabled").hide(),this.clearSelectionButton.addClass("disabled").hide()):(this.element.removeClass("readonly"),this.containerDiv.removeClass("select2-container-disabled"),this.inplaceSearchButton.removeClass("disabled").show(),this.clearSelectionButton.removeClass("disabled").show())}get_required(){return this.element.hasClass("required")}set_required(e){e?(this.element.addClass("required"),this.containerDiv.addClass("required"),this.containerDiv.find(".select2-choice, display-text").addClass("required")):(this.element.removeClass("required"),this.containerDiv.removeClass("required"),this.containerDiv.find(".select2-choice, display-text").removeClass("required"))}get selectedItem(){if(this._selectedItem&&this._selectedItem[this.options.nameFieldInGridRow]&&this.selectedItemIncludeColumns.every(e=>this._selectedItem[e]))return this._selectedItem;if(!(0,u.isEmptyOrNull)(this.value))return(0,u.serviceCall)({service:this.serviceUrl+"/Retrieve",request:{EntityId:this.value,ColumnSelection:u.RetrieveColumnSelection.list,IncludeColumns:this.selectedItemIncludeColumns},async:!1,onSuccess:e=>{this._selectedItem=e.Entity}}),this._selectedItem}get serviceUrl(){if((0,u.isEmptyOrNull)(this._serviceUrl)){var e=this.getDialogInstance();this._serviceUrl=e.getService()}return this._serviceUrl}setValueAndText(e,t){this.value=e,this.text=t}getCascadeFromValue(e){return u.EditorUtils.getValue(e)}setCascadeFrom(e){if((0,u.isEmptyOrNull)(e)){this.cascadeLink!=null&&(this.cascadeLink.set_parentID(null),this.cascadeLink=null),this.options.cascadeFrom=null;return}this.cascadeLink=new u.CascadedWidgetLink(u.Widget,this,t=>{this.set_cascadeValue(this.getCascadeFromValue(t))}),this.cascadeLink.set_parentID(e),this.options.cascadeFrom=e}get_cascadeFrom(){return this.options.cascadeFrom}get cascadeFrom(){return this.get_cascadeFrom()}set_cascadeFrom(e){e!==this.options.cascadeFrom&&(this.setCascadeFrom(e),this.updateItems())}set cascadeFrom(e){this.set_cascadeFrom(e)}get_cascadeField(){return(0,u.coalesce)(this.options.cascadeField,this.options.cascadeFrom)}get cascadeField(){return this.get_cascadeField()}set_cascadeField(e){this.options.cascadeField=e}set cascadeField(e){this.set_cascadeField(e)}get_cascadeValue(){return this.options.cascadeValue}get cascadeValue(){return this.get_cascadeValue()}set_cascadeValue(e){this.options.cascadeValue!==e&&(this.options.cascadeValue=e,this.set_value(null),this.updateItems())}set cascadeValue(e){this.set_cascadeValue(e)}get_filterField(){return this.options.filterField}get filterField(){return this.get_filterField()}set_filterField(e){this.options.filterField=e}set filterField(e){this.set_filterField(e)}get_filterValue(){return this.options.filterValue}get filterValue(){return this.get_filterValue()}set_filterValue(e){this.options.filterValue!==e&&(this.options.filterValue=e,this.set_value(null),this.updateItems())}set filterValue(e){this.set_filterValue(e)}updateItems(){}};l(T,"GridItemPickerEditor"),T=S([u.Decorators.registerEditor("_Ext.GridItemPickerEditor",[u.ISetEditValue,u.IGetEditValue,u.IStringValue,u.IReadOnly,u.IValidateRequired]),u.Decorators.element('<input type="text" />')],T);var re=h(m(),1);function ye(c){$.ajax({url:c,dataType:"script",async:!1,cache:!0,success:function(){},error:function(){throw new Error("Could not load script "+c)}})}l(ye,"loadScript");function xe(){window.Slick&&window.Slick.Editors&&window.Slick.Editors.Text||ye((0,re.resolveUrl)("~/lib/_Ext/Editors/slick.editors.js"))}l(xe,"usingSlickGridEditors");function ve(){window.Slick&&window.Slick.AutoColumnSize||ye((0,re.resolveUrl)("~/lib/_Ext/CustomSlickGridPlugin/slick.autocolumnsize.js"))}l(ve,"usingSlickAutoColumnSize");var K=h(Te(),1),be=h(Re(),1);var O=class extends a.EntityGrid{constructor(e,t){super(e,t);this.isAutosized=!1;this.isChildGrid=!1;this.nextRowNumber=1;this.get_ExtGridOptions().AutoColumnSize==!0&&this.slickContainer.fadeTo(0,0);let s=this.getGrouping();s.length>0&&this.setGrouping(s)}get_ExtGridOptions(){return(0,a.deepClone)(te)}isPickerMode(){return this.element.hasClass("RowSelectionCheckGrid")}getGrouping(){return[]}createToolbarExtensions(){super.createToolbarExtensions(),this.rowSelection=new a.GridRowSelectionMixin(this)}markupReady(){super.markupReady(),setTimeout(()=>{this.isAutosized==!1&&(this.get_ExtGridOptions().AutoColumnSize==!0&&this.resizeAllCulumn(),this.slickContainer.fadeTo(100,1))},100)}getButtons(){var e=super.getButtons();let t=this.getReportRequest();return t.ListExcelServiceMethodName&&e.push(K.ExcelExportHelper.createToolButton({grid:this,service:this.getService()+"/"+t.ListExcelServiceMethodName,onViewSubmit:()=>this.onViewSubmit(),separator:!0})),t.ReportKey?(e.push({title:y("Controls.ExportToPDF","Export to PDF"),icon:"fa fa-file-pdf-o",onClick:()=>{let r=this.getReportRequest();r&&K.ReportHelper.execute({reportKey:t.ReportKey,params:{request:r}})}}),e.push({title:y("Controls.ViewAsReport","View as Report"),icon:"fa fa-html5",onClick:()=>{let r=this.getReportRequest();r&&K.ReportHelper.execute({reportKey:t.ReportKey,params:{request:r},extension:"html"})}})):t.ReportServiceMethodName&&e.push({title:y("Controls.ViewAsReport","View as Report"),icon:"fa fa-eye",onClick:()=>{let r=this.getReportRequest();r&&(0,a.postToService)({service:(0,a.resolveUrl)(this.getService()+"/"+t.ReportServiceMethodName),request:r,target:"_blank"})}}),e}getReportRequest(){let e=this.getView();var t=(0,a.deepClone)(e?e.params:{});if(t.ReportServiceMethodName=null,t.ReportKey=null,t.ListExcelServiceMethodName=pe,t.EqualityFilterWithTextValue={},t.CustomParameters={},e){let s=this.getQuickFilters();for(let i of s){let o=t.EqualityFilter[i.field];if(o&&o.length>0)if(i.options.lookupKey){let p=(0,a.getLookup)(i.options.lookupKey);t.EqualityFilterWithTextValue[i.title]=p.itemById[o][p.textField]}else if(i.options.enumKey){let p=i.options.enumKey,f=(0,a.toId)(o);t.EqualityFilterWithTextValue[i.title]=a.EnumFormatter.format(a.EnumTypeRegistry.get(p),f)}else if(i.type==T){var r=this.findQuickFilter(T,i.field);t.EqualityFilterWithTextValue[i.title]=r.text}else t.EqualityFilterWithTextValue[i.title]=o;else if(i.type==a.DateEditor){let p=this.findQuickFilter(a.DateEditor,i.field),f=p.element.val(),n=p.element.siblings("input").val(),d="";(0,a.isEmptyOrNull)(f)||(d=(0,a.format)(y("Controls.FromDate","From {0}"),f)+" "),(0,a.isEmptyOrNull)(n)||(d=d+(0,a.format)(y("Controls.ToDate","To {0}"),n)),(0,a.isEmptyOrNull)(d)?this.get_ExtGridOptions().ShowAnyInEqualityFilterWithTextValue==!0&&(t.EqualityFilterWithTextValue[i.title]=y("Controls.All","all")):t.EqualityFilterWithTextValue[i.title]=d}else this.get_ExtGridOptions().ShowAnyInEqualityFilterWithTextValue==!0&&(t.EqualityFilterWithTextValue[i.title]=y("Controls.All","all"))}if(this.filterBar){let i=this.filterBar.get_store().get_displayText();(0,a.isEmptyOrNull)(i)||(t.EqualityFilterWithTextValue[(0,a.text)("Controls.FilterPanel.EditFilter")]=i)}}return t}getColumns(){let e=super.getColumns(),t=this.getSlickOptions().editable,r=this.get_ExtGridOptions();if(t==!0&&xe(),e.forEach(i=>{let o=i.cssClass||"",p=i.minWidth||i.width||50;if(i.sourceItem){let f=i.sourceItem.formatterType;i.sourceItem.filteringType=="Lookup"?(o=" align-left",p=i.minWidth>100?i.minWidth:100):f=="Enum"?p=i.minWidth>100?i.minWidth:100:f=="Date"?(o=" align-center",p=i.minWidth>99?i.minWidth:99):f=="DateTime"?(o=" align-center",p=i.minWidth>140?i.minWidth:140):f=="Number"?o=" align-right":f=="Checkbox"?o=" align-center":(o=" align-left",p=i.minWidth>99?i.minWidth:99);let n=i.sourceItem.placeholder=="Controls.All"?y("Controls.All","All"):"-";if(i.sourceItem.editorType=="Lookup")i.sourceItem.editorParams.autoComplete||(i.format=d=>{let v=(0,a.getLookup)(i.sourceItem.editorParams.lookupKey);if(d.column.sourceItem.editorParams.multiple==!0){if(d.value){let A=d.value.map(N=>v.itemById[N]).map(N=>N[v.textField]);return A.length>0?A.join(", "):n}}else{let b=v.itemById[d.value];return b?b[v.textField]:n}});else if(i.sourceItem.editorType=="ServiceLookup")i.sourceItem.editorParams.autoComplete||(i.format=d=>{let v=i.sourceItem.editorParams.textFieldInThisRow||i.sourceItem.editorParams.textField;return d.item?d.item[v]:n});else if(i.sourceItem.filteringType=="Lookup")i.format=d=>(0,a.isEmptyOrNull)(d.value)?n:d.value;else if(f=="Enum")i.format=d=>{let v=d.column.sourceItem.editorParams.enumKey;if(d.column.sourceItem.editorParams.multiple==!0){let b="",A=d.value;return A&&A.length>0&&(b=A.map(N=>a.EnumFormatter.format(a.EnumTypeRegistry.get(v),(0,a.toId)(N))).join(", ")),b||n}else{let b=a.EnumFormatter.format(a.EnumTypeRegistry.get(v),(0,a.toId)(d.value));return b||n}};else if(i.sourceItem.editorType=="Decimal"){let d="#,##0.00";if(i.sourceItem.editorParams){let v=i.sourceItem.editorParams.decimals;if(v){d="#,##0.";for(let b=0;b<v;b++)d+="0"}else if(i.sourceItem.editorParams.minValue){let b=i.sourceItem.editorParams.minValue.split(".");b.length>1?d="#,##0."+b[1]:d="#,##0"}}i.format=v=>a.NumberFormatter.format(v.value,d)}if(t==!0&&i.sourceItem.readOnly!=!0)if(he)i.editor=SerenityInlineEditor;else{let d=i.sourceItem.editorType;d=="Lookup"||d=="Enum"?(i.editor=Slick.Editors.Select2,p=i.minWidth>160?i.minWidth:160):d=="Date"?i.editor=Slick.Editors.Date:d=="Boolean"?i.editor=Slick.Editors.Checkbox:d=="Integer"?i.editor=Slick.Editors.Integer:d=="Decimal"?i.editor=Slick.Editors.Float:d=="YesNoSelect"?i.editor=Slick.Editors.YesNoSelect:d=="PercentComplete"?i.editor=Slick.Editors.PercentComplete:d=="LongText"?i.editor=Slick.Editors.LongText:i.editor=Slick.Editors.Text}}i.cssClass+=o,this.get_ExtGridOptions().AutoColumnSize==!0&&(i.width=p)}),e.unshift({field:"RowNum",name:"#",cssClass:"rownum-column",headerCssClass:"align-center",width:40,minWidth:40,maxWidth:40,visible:r.ShowRowNumberColumn,format:i=>(i.item.RowNum||(i.item.RowNum=this.nextRowNumber++),String(i.item.RowNum))}),r.ShowInlineActionsColumn==!0){let i=0,o="";if(r.ShowEditInlineButtun==!0){i+=32;var s=this.isReadOnly?y("Controls.View","View Details"):y("Controls.Edit","Edit");o+=`<a class="inline-actions view-details" title="${s}" style="font-size: 1.2em;"><i class="view-details fa fa-pencil-square-o"></i></a>`}r.ShowDeleteInlineButtun==!0&&(i+=22,o+=`<a class="inline-actions delete-row" title="${y("Controls.Delete","Delete")}" style="padding-left: 5px;"><i class="delete-row fa fa-trash-o text-red"></i></a>`),r.ShowPrintInlineButtun==!0&&(i+=25,o+=`<a class="inline-actions print-row" title="${y("Controls.Print","Print")}" style="padding-left: 5px;"><i class="print-row fa fa-print"></i></a>`),e.unshift({field:"inline-actions",name:"",cssClass:"inline-actions-column",width:i,minWidth:i,maxWidth:i,formatter:(p,f,n,d,v)=>o})}if(r.ShowRowSelectionCheckboxColumn==!0){let i=a.GridRowSelectionMixin.createSelectColumn(()=>this.rowSelection);i.width=i.minWidth=i.maxWidth=27,e.unshift(i)}if(this.isPickerMode()){let i=this.options;if(!i.multiple&&!i.gridType&&(0,a.notifyWarning)("Could not determine multiple/single. Probably there is no 'options' parameter in grid's constructor."),e.forEach(o=>{o.sourceItem&&o.sourceItem.editLink&&(o.format=void 0)}),i.multiple==!0){let o=a.GridRowSelectionMixin.createSelectColumn(()=>this.rowSelection);o.width=o.minWidth=o.maxWidth=27,e.unshift(o)}else e.unshift({field:"row-selection",name:"",cssClass:"inline-actions-column",width:66,minWidth:66,maxWidth:66,format:o=>'<a class="inline-actions select-row"><i class="select-row fa fa-check"></i> Select</a>'})}return e}createSlickGrid(){var e=super.createSlickGrid();return ve(),Slick.AutoColumnSize&&(this.autoColumnSizePlugin=new Slick.AutoColumnSize,e.registerPlugin(this.autoColumnSizePlugin)),e.registerPlugin(new be.GroupItemMetadataProvider),e}resetColumns(e){this.slickContainer.fadeTo(0,0),this.slickGrid.setColumns(e),setTimeout(()=>{this.get_ExtGridOptions().AutoColumnSize==!0&&this.resizeAllCulumn(),this.slickContainer.fadeTo(100,1)},100)}resizeAllCulumn(){this.isAutosized=!0;let e=this.slickContainer.width();e>0||(e=this.element.closest(".s-Dialog").width()-55),e>0||(e=this.element.closest(".s-Panel").width()-55),e>0||(e=$("section.content").width()-75),this.slickGrid.setOptions({forceFitColumns:!1});let t=this.autoColumnSizePlugin.resizeAllColumns().filter(s=>s.visible!=!1),r=0;if(t.map(s=>s.width).forEach(s=>r+=s),r>e)this.autoColumnSizePlugin.resizeAllColumns();else if(r<e){this.autoColumnSizePlugin.resizeAllColumns();let s=[],i=[];t.forEach(n=>{n.minWidth==n.maxWidth?(s.push(n),n.width=n.maxWidth):n.cssClass&&n.cssClass.indexOf("no-auto-size")>=0?s.push(n):n.sourceItem?n.sourceItem.formatterType==String("Number")?s.push(n):n.sourceItem.filteringType==String("Enum")||n.sourceItem.formatterType==String("Date")?(s.push(n),n.width<80&&(n.width=80)):n.sourceItem.formatterType==String("DateTime")?(s.push(n),n.width<150&&(n.width=150)):n.sourceItem.formatterType==String("Checkbox")?s.push(n):i.push(n):i.push(n)}),i.length==0&&(s=[],i=[],t.forEach(n=>{n.minWidth==n.maxWidth?(s.push(n),n.width=n.maxWidth):i.push(n)}));let o=0;s.map(n=>n.width).forEach(n=>o+=n);let p=e-o-(this.isChildGrid?48:18),f=0;i.map(n=>n.width).forEach(n=>f+=n),i.forEach(n=>{let d=p/f,v=n.width*d,b=v-n.width;n.width=v}),this.slickGrid.setColumns(t),this.slickGrid.onColumnsResized.notify()}this.setItems(this.getItems())}getSlickOptions(){let e=super.getSlickOptions();return this.get_ExtGridOptions().AutoColumnSize==!0&&(e.forceFitColumns=!0),e.enableTextSelectionOnCells=!0,e.enableCellNavigation=!0,e.asyncEditorLoading=!1,e.autoEdit=!0,e.rowHeight=27,e}getViewOptions(){let e=super.getViewOptions();return this.usePager()&&(e.rowsPerPage=te.RowsPerPage),e}getPrintRowServiceMethod(){return"Print"}onClick(e,t,r){if(super.onClick(e,t,r),e.isDefaultPrevented())return;var s=this.itemAt(t);let i=s[this.getIdProperty()];var o=$(e.target);(o.parent().hasClass("inline-action")||o.parent().hasClass("inline-actions")||o.parent().hasClass("inline-btn"))&&(o=o.parent()),(o.hasClass("inline-action")||o.hasClass("inline-actions")||o.hasClass("inline-btn"))&&this.onInlineActionClick(o,i,s)}onInlineActionClick(e,t,r){if(e.hasClass("delete-row"))this.isReadOnly==!0?(0,a.notifyWarning)("Read only records could not be deleted!"):(0,a.confirmDialog)(y("Db.Administration.Translation.DeleteWarning","Delete record?"),()=>{let s=this;s.deleteEntity?s.deleteEntity(t):(0,a.serviceRequest)(this.getService()+"/Delete",{EntityId:t},i=>{this.refresh()})});else if(e.hasClass("view-details"))this.slickGrid.getEditController().commitCurrentEdit(),this.editItem(t);else if(e.hasClass("print-row")){let s={EntityId:t};(0,a.postToService)({service:(0,a.resolveUrl)(this.getService()+"/"+this.getPrintRowServiceMethod()),request:s,target:"_blank"})}else e.hasClass("select-row")&&(this.rowSelection.setSelectedKeys([t]),this.pickerDialog.onSuccess(this.selectedItems),this.pickerDialog.dialogClose())}resetRowNumber(){this.nextRowNumber=1;let e=this.getItems(),t=this.view.getGrouping();if(t.length==0)for(let r=0;r<e.length;r++)e[r].RowNum=r+1;else if(t.length>0){let r=l(i=>{for(let o=0;o<i.length;o++){let p=i[o].groups;if(p)r(p);else{let f=i[o].rows;for(let n=0;n<f.length;n++)f[n].RowNum=n+1}}},"generateRowNumber"),s=this.view.getGroups();r(s)}this.setItems(e)}setGrouping(e){this.view.setGrouping(e),this.resetRowNumber()}getIncludeColumns(e){super.getIncludeColumns(e);let t=this.getGrouping();t.length>0&&t.forEach(r=>e[r.getter]=!0)}getDefaultSortBy(){let e=super.getDefaultSortBy(),t=this.getGrouping();return t.length>0&&t.forEach(r=>e.unshift(r.getter)),e}onViewProcessData(e){let t=super.onViewProcessData(e);return this.get_ExtGridOptions().ShowRowNumberColumn==!0&&setTimeout(()=>{this.resetRowNumber()}),t}initDialog(e){super.initDialog(e),e.parentGrid=this}get selectedItems(){return this.rowSelection.getSelectedKeys().map(e=>{let t=this.view.getItemById(e);return t||(t={},t[this.getIdProperty()]=e),t})}set selectedKeys(e){this.options.multiple==!0&&this.rowSelection.setSelectedKeys(e)}onViewSubmit(){if(!super.onViewSubmit())return!1;var e=this.view.params;let t=this.options;t.filteringCriteria&&(e.Criteria=a.Criteria.and(e.Criteria,t.filteringCriteria)),t.filterField&&(0,a.isValue)(t.filterValue)&&(e.EqualityFilter=e.EqualityFilter||{},e.EqualityFilter[t.filterField]=t.filterValue);let r=t.cascadeField||t.cascadeFrom;return r&&(0,a.isValue)(t.cascadeValue)&&(e.EqualityFilter=e.EqualityFilter||{},e.EqualityFilter[r]=t.cascadeValue),!0}};l(O,"GridBase"),O=S([a.Decorators.filterable()],O);var M=class extends O{constructor(e,t){super(e,t);this.isChildGrid=!0;this.nextId=1;this.slickGrid.onSort.subscribe((r,s)=>{this.sortGridFunction(s.grid,s.sortCols[0],s.sortCols[0].sortCol.field),s.grid.invalidateAllRows(),s.grid.invalidate(),s.grid.render(),s.grid.resizeCanvas()})}get_ExtGridOptions(){return(0,x.deepClone)(me)}getIdProperty(){return"__id"}sortGridFunction(e,t,r){e.getData().sort(function(s,i){var o=s[r]>i[r]?1:s[r]<i[r]?-1:0;return t.sortAsc?o:-o})}getQuickFilters(){return[]}id(e){return e[this.getIdProperty()]}save(e,t){var r=e.request,s=(0,x.deepClone)(r.Entity),i=this.id(s);if(i==null&&(s[this.getIdProperty()]="`"+this.nextId++),!!this.validateEntity(s,i)){var o=this.view.getItems().slice();if(i==null)o.push(s);else{var p=(0,x.indexOf)(o,f=>this.id(f)===i);o[p]=(0,x.deepClone)({},o[p],s)}this.value=o,t({})}}deleteEntity(e){return this.view.deleteItem(e),setTimeout(()=>{this.onItemsChanged(),this.element.trigger("change"),this.resetRowNumber()}),!0}validateEntity(e,t){return!0}getNewEntity(){return{}}getButtons(){return[{title:this.getItemName(),cssClass:"add-button",onClick:()=>{this.addButtonClick()}}]}addButtonClick(){this.createEntityDialog(this.getItemType(),e=>{var t=e;t.parentEditor=this,t.onSave=(r,s)=>this.save(r,s),t.loadEntityAndOpenDialog(this.getNewEntity())})}editItem(e){var t=e,r=this.view.getItemById(t);this.createEntityDialog(this.getItemType(),s=>{var i=s;i.onDelete=(o,p)=>{this.deleteEntity(t)&&p({})},i.parentEditor=this,i.onSave=(o,p)=>this.save(o,p),i.loadEntityAndOpenDialog(r)})}getEditValue(e,t){t[e.name]=this.value}setEditValue(e,t){this.value=e[t.name]}get value(){var e=this.getIdProperty();this.slickGrid.getEditController().commitCurrentEdit();let t=this.view.getItems();return this.onBeforeGetValue(t),t.map(r=>{var s=(0,x.deepClone)(r),i=s[e];return i&&i.toString().charAt(0)=="`"&&delete s[e],s.RowNum&&delete s.RowNum,s})}set value(e){var t=this.getIdProperty();let s=(e||[]).map(o=>{var p=(0,x.deepClone)(o);return p[t]==null&&(p[t]="`"+this.nextId++),p}),i=this.onViewProcessData({Entities:s});this.view.setItems(i.Entities,!0),setTimeout(()=>{this.onItemsChanged(),this.element.trigger("change")}),this.resetRowNumber()}getGridCanLoad(){return!1}usePager(){return!1}getInitialTitle(){return null}createToolbarExtensions(){this.get_ExtGridOptions().EnableQuickSearch&&x.GridUtils.addQuickSearchInputCustom(this.toolbar.element,(e,t)=>{this.searchText=Select2.util.stripDiacritics((0,x.trimToNull)(t)||"").toLowerCase(),this.view.setItems(this.view.getItems(),!0)})}onViewFilter(e){return super.onViewFilter(e)?this.searchText?this.matchContains(e):!0:!1}matchContains(e){let t=!1;for(let r in e)if(t=Select2.util.stripDiacritics(String(e[r]||"")).toLowerCase().indexOf(this.searchText)>=0,t==!0)return t;return t}getFilteredItems(){return this.getItems().filter(e=>this.matchContains(e))}enableFiltering(){return!1}onViewSubmit(){return!1}get_readOnly(){return this.isReadOnly}set_readOnly(e){if(this.isReadOnly=e,e==!0){this.element.find(".add-button").addClass("disabled");let t=this.slickGrid.getOptions();t.editable=!1,this.slickGrid.setOptions(t)}else this.element.find(".add-button").removeClass("disabled")}getSlickOptions(){let e=super.getSlickOptions();return e.forceFitColumns=!1,e}onItemsChanged(){}onBeforeGetValue(e){}};l(M,"GridEditorBaseWithOption"),M=S([x.Decorators.registerClass([x.IGetEditValue,x.ISetEditValue,x.IReadOnly]),x.Decorators.editor(),x.Decorators.element("<div/>")],M);var H=class extends M{};l(H,"GridEditorBase");var De=h(m(),1);var P=h(m(),1);var C=h(m(),1);var W=h(m(),1);function Ce(c,g){c.on("dialogbeforeclose panelbeforeclose",function(e){!W.WX.hasOriginalEvent(e)||!g()||(e.preventDefault(),(0,W.confirmDialog)(y("Controls.EntityDialog.PendingChangesConfirmation","You have pending changes. Save them?"),()=>c.find("div.save-and-close-button").click(),{onNo:function(){c.hasClass("ui-dialog-content")?c.dialog("close"):c.hasClass("s-Panel")&&W.TemplatedDialog.closePanel(c)}}))})}l(Ce,"pendingChangesConfirmation");var Se=h(m(),1);function Oe(){return(0,Se.getRemoteData)("UserData")}l(Oe,"userDefinition");function we(c){let g=Oe();return g.Username==="admin"||!!g.Permissions[c]}l(we,"hasPermission");var B=class extends C.EntityDialog{constructor(e){super(e);this.isReadOnly=!1;this.get_ExtDialogOptions().PendingChangesConfirmation==!0&&Ce(this.element,()=>this.getSaveState()!=this.loadedState)}get_ExtDialogOptions(){return(0,C.deepClone)(fe)}getTenantIdEditor(){return this.form.TenantId}updateInterface(){super.updateInterface(),this.setReadOnly(this.isReadOnly),ue(this.getTenantIdEditor(),we("Administration:Tenant:Update"))}onDialogOpen(){super.onDialogOpen();let e=this.get_ExtDialogOptions();if(e.AutoFitContentArea==!0&&this.fullContentArea(),e.HideCategoyLinksBar==!0){this.element.find(".category-links").hide();let t=this.element.find(".first-category > .category-title");(0,C.isEmptyOrNull)(t.find(".category-anchor").text())&&t.hide()}if(e.ShowKeyboardLayoutButtonInToolbar==!0){let t=this.element}setTimeout(()=>{this.onAfterSetDialogSize()},200)}onDialogClose(){super.onDialogClose(),this.onAfterDialogClose(this.getSaveEntity())}setReadOnly(e){if(this.readOnly=e,this.isReadOnly=e,this.isReadOnly==!0){this.saveAndCloseButton.toggleClass("disabled",this.isReadOnly),this.applyChangesButton.toggleClass("disabled",this.isReadOnly),this.deleteButton.toggleClass("disabled",this.isReadOnly),this.cloneButton.toggleClass("disabled",this.isReadOnly),this.undeleteButton.toggleClass("disabled",this.isReadOnly),this.toolbar.findButton("btn-save-and-close").addClass("disabled"),this.toolbar.findButton("btn-save-and-new").addClass("disabled"),this.toolbar.findButton("btn-replace-row").addClass("disabled"),this.toolbar.findButton("btn-history").addClass("disabled"),this.toolbar.findButton("btn-custom").addClass("disabled"),this.element.find("sup").toggle(this.isReadOnly);for(let t in this.form)if(this.form[t].widgetName)try{C.EditorUtils.setReadOnly(this.form[t],this.isReadOnly)}catch(r){}}}getToolbarButtons(){let e=super.getToolbarButtons(),t=this.get_ExtDialogOptions();t.ShowSaveAndNewButtonInToolbar==!0&&e.push({title:y("Controls.EntityDialog.SaveAndNew","Save & New"),icon:"fa fa-save",cssClass:"btn-save-and-new",onClick:()=>{this.onSaveAndNewButtonClick()}}),t.ShowCloseButtonInToolbar==!0&&e.push({title:y("Controls.EntityDialog.Close","Close"),icon:"fa fa-close",cssClass:"btn-close",onClick:()=>{this.dialogClose()}}),t.ShowRefreshButtonInToolbar==!0&&e.push({title:y("Controls.EntityDialog.Refresh","Refresh"),icon:"fa fa-refresh",onClick:()=>{this.onRefreshClick()}});try{let r=(0,C.tryFirst)(e,s=>s.cssClass=="clone-button");r.onClick=()=>{if(this.isEditMode()){var s=this.getCloningEntity();C.Widget.create({type:(0,C.getInstanceType)(this),init:i=>{this.parentGrid.initDialog(i),i.loadEntityAndOpenDialog(s,null)}}),this.dialogClose()}}}catch(r){}return e}onRefreshClick(){this.reloadById()}onSaveAndNewButtonClick(){this.save(e=>{this.loadEntity({})})}getSaveState(){try{return $.toJSON(this.getSaveEntity())}catch(e){return null}}onSaveSuccess(e){super.onSaveSuccess(e)}loadResponse(e){super.loadResponse(e),this.get_ExtDialogOptions().PendingChangesConfirmation==!0&&(this.loadedState=this.getSaveState())}maximize(){this.element.closest(".ui-dialog").find(".ui-dialog-titlebar-maximize").click(),setTimeout(()=>{let e=this.element?this.element.closest(".ui-dialog"):$(".ui-dialog"),t=e.height(),r=e.find(".ui-dialog-title").height()||20,s=this.element.find(".categories"),i=s.position().top;s.height(t-r-i-20)},100)}fullContentArea(){window.innerWidth>768&&this.setDialogSize()}setDialogSize(e,t,r,s,i){i||(i=$("section.content")),i.length==0&&(i=$(".content-wrapper"));let o=this.element?this.element.closest(".ui-dialog"):$(".ui-dialog");if(i.length>0&&o.length>0){let p=i.width()+28+(e||0),f=i.height()+(t||30);this.element.dialog("option","width",p),this.element.dialog("option","height",f);let n=o.find(".ui-dialog-title").height()||20,d=this.element.find(".categories"),v=d.position().top;d.height(f-n-v-20),o.css({left:i.position().left+(s||2),top:r||50})}setTimeout(()=>{this.onAfterSetDialogSize()},200)}onAfterSetDialogSize(){}onAfterDialogClose(e){}};l(B,"DialogBase"),B=S([C.Decorators.responsive(),C.Decorators.maximizable()],B);var F=class extends B{get_ExtDialogOptions(){return(0,P.deepClone)(ge)}getIdProperty(){return"__id"}destroy(){this.onSave=null,this.onDelete=null,super.destroy()}updateInterface(){this.parentEditor&&this.parentEditor.isReadOnly==!0&&(this.isReadOnly=!0),super.updateInterface();let e=this.isNew()?(0,P.tryGetText)("Controls.AddButton")||"Add":(0,P.tryGetText)("Controls.ApplyButton")||"Apply";this.saveAndCloseButton.find(".button-inner").html(`<i class="fa fa-check-circle text-purple"></i> ${e}`),this.applyChangesButton&&this.applyChangesButton.hide()}saveHandler(e,t){this.onSave&&this.onSave(e,t)}deleteHandler(e,t){this.onDelete&&this.onDelete(e,t)}};l(F,"EditorDialogBase"),F=S([P.Decorators.registerClass()],F);var G=class extends F{constructor(){super(...arguments);this.form=new k(this.idPrefix)}getFormKey(){return k.formKey}getRowDefinition(){return w}getService(){return Y.baseUrl}};l(G,"BusinessTripDetailEditorDialog"),G=S([De.Decorators.registerClass("Maps_Project.Trip.BusinessTripDetailEditorDialog")],G);var q=class extends H{constructor(e){super(e)}getColumnsKey(){return R.columnsKey}getDialogType(){return G}getLocalTextPrefix(){return w.localTextPrefix}};l(q,"BusinessTripDetailEditor"),q=S([Ee.Decorators.registerEditor("Maps_Project.Trip.BusinessTripDetailEditor")],q);var L=h(m(),1);var j=class extends L.PrefixedContext{constructor(g){if(super(g),!j.init){j.init=!0;var e=L.StringEditor,t=q;(0,L.initFormType)(j,["Title",e,"Description",e,"DetailList",t])}}},Z=j;l(Z,"BusinessTripForm"),Z.formKey="Trip.BusinessTrip";export{z as a,R as b,k as c,w as d,Y as e,Z as f,D as g,ae as h};
//# sourceMappingURL=chunk-DTQ6TSSQ.js.map
